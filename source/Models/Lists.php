<?php

namespace Source\Models;

use Source\Core\Model;

class Lists extends Model
{
    public function __construct()
    {
        parent::__construct('lists', ['id', 'created_at', 'updated_at'],
            ['id_hour', 'id_store', 'total_value', 'comission_value', 'net_value', 'day', 'date_moviment']);
    }

    public function bootstrap(
        int $descriptionHour,
        int $idStore,
        float $totalValue,
        string $dateMoviment
    ): Lists {
        $this->id_hour = $descriptionHour;
        $this->id_store = $idStore;
        $this->total_value = $totalValue;
        $this->date_moviment = $dateMoviment;
        return $this;
    }

    public function hour(): ?Hour
    {
        if ($this->id_hour) {
            return (new Hour())->findById($this->id_hour);
        }
        return null;
    }

    public function store(): ?Store
    {
        if ($this->id_store) {
            (new $this);
            return (new Store())->findById($this->id_store);
        }
        return null;
    }

    public function save(): bool
    {

        $this->comission_value = (($this->total_value * $this->store()->comissao) / 100);
        (new Lists());
        $this->net_value = $this->total_value - $this->comission_value;
        $this->day = $this->weekDay();

        return parent::save(); // TODO: Change the autogenerated stub
    }

    public function weekDay(): string
    {
        $meses = array(
            1 => "Janeiro",
            2 => "Fevereiro",
            3 => "Março",
            4 => "Abril",
            5 => "Maio",
            6 => "Junho",
            7 => "Julho",
            8 => "Agosto",
            9 => "Setembro",
            10 => "Outubro",
            11 => "Novembro",
            12 => "Dezembro"
        );
        $weekDays = array(
            1 => "Segunda-Feira",
            2 => "Terça-Feira",
            3 => "Quarta-Feira",
            4 => "Quinta-Feira",
            5 => "Sexta-Feira",
            6 => "Sábado",
            0 => "Domingo"
        );

        $date = $this->date_moviment;
        $date = str_replace('/', '-', $date);

        $today = getdate(strtotime($date));

        $dia = $today["mday"];
        $mes = $today["mon"];
        $nomemes = $meses[$mes];
        $ano = $today["year"];
        $weekDay = $today["wday"];
        $weekDayName = $weekDays[$weekDay];

        return $weekDayName;
    }


}